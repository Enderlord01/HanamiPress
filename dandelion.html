<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ASCII Art con Soffio</title>
  <style>
    pre {
      font-family: monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <pre id="ascii-art">
      _.--'--._
    .'. ':. ' :'.
   '`' : `. `: ':'  
  : : '.'. .'.':.`:
  :' -`= `+ .= - `:
  :.' .'.' :.'.`:':
   : : .:`' .:`.':
    '.: . :`. :.'
      `'--,--'`  
  </pre>

  <script>
    // ASCII Art iniziale
    let asciiArt = `      _.--'--._
    .'. ':. ' :'.
   \`' : \`. \`: ':'  
  : : '.'. .'.':.\`:
  :' -\`= \`+ .= - \`:
  :.' .'.' :.'.\`:':
   : : .:\`' .:\`.':
    '.: . :\`. :.'
      \`'--,--'\`  
          y
         ( 
          \\       _
           \\    /`/
     _      |__/:/_  
     \\`\\    |\\ :  /
     _\\:\\_  /\\ : /_
     \\ : /_/\\  : /
     _\\ : /_/ : /
     \\  :  /.'/\`
 jgs  \`\\ :/'/`\``;
    
    let textElement = document.getElementById("ascii-art");
    
    // Funzione per rimuovere un carattere dalla fine
    function removeChar() {
      if (asciiArt.length > 0) {
        asciiArt = asciiArt.slice(0, -1); // Rimuove l'ultimo carattere
        textElement.textContent = asciiArt; // Aggiorna il contenuto
      }
    }

    // Funzione per rilevare il suono
    function detectSound() {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(function(stream) {
          let audioContext = new (window.AudioContext || window.webkitAudioContext)();
          let analyser = audioContext.createAnalyser();
          let source = audioContext.createMediaStreamSource(stream);
          source.connect(analyser);
          
          analyser.fftSize = 256;
          let bufferLength = analyser.frequencyBinCount;
          let dataArray = new Uint8Array(bufferLength);

          function checkSound() {
            analyser.getByteFrequencyData(dataArray);
            let sum = 0;
            for (let i = 0; i < bufferLength; i++) {
              sum += dataArray[i];
            }

            // Se il suono Ã¨ abbastanza forte (soglia di 1000)
            if (sum > 1000) {
              removeChar();
            }

            requestAnimationFrame(checkSound);
          }

          checkSound();
        })
        .catch(function(error) {
          console.log("Errore nell'accesso al microfono", error);
        });
    }

    // Inizia a rilevare il suono
    detectSound();
  </script>
</body>
</html>
